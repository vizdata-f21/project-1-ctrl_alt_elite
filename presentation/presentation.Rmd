---
title: "Twitter Trends in #DuBoisChallenge"
author: "Ctrl Alt Elite <br> Andrew Blosse, Anna Greenleaf, Sana Pashankar, & Raghav Rasal"
institute: "Duke University"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
# Remove any packages from this list that you're not using
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)

library(tidyverse)
library(maps)
library(sf)
library(rnaturalearth)
library(rvest)
library(ggthemes)
library(lubridate)
library(stringr)
library(colorspace)
library(scales)

library(showtext)
library(ggrepel)
library(patchwork)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 8, 
  fig.asp = 0.618, 
  out.width = "70%"
  )
```

```{r load-data, include=FALSE}
tweets <- read.csv("../data/tweets.csv")
```

```{r style-slides, echo = FALSE}
style_xaringan(
  title_slide_background_image = "img/watercolour_sys02_img34_teacup-ocean.jpg"
)
```

class: inverse, middle, center


## Introduction

- William Edward Burghardt Du Bois (W.E.B. Du Bois) was an American data 
visualization expert whose work challenged racist notions

- The #DuBoisChallenge encouraged creative recreations of his visualizations in a 
modern context

- Dataset consists of tweets that include "#DuBoisChallenge" and their various 
charactersitics such as location, number of retweets, number of followers etc.

- Motivation to analyze dataset - aim to dive deeper into how people across the
world engage with history and data visualizations through social media

```{r echo = FALSE, out.width = "20%", fig.align = "center"}
include_graphics("images/dubois285.jpeg")
```


---

class: inverse, middle, center

# Question #1 : How does general interest of the #DuBois challenge vary geographically?

---


## Question 1 - Location Tweets

```{r question-one-plot-one-wrangling, echo = FALSE}

tweets_locations <- tweets %>%
  filter(!str_detect(location, "@"), !str_detect(location, ":")) %>%
  mutate(location_pre_comma = gsub(",.*", "", location)) %>%
  mutate(location_pre_comma = case_when(
    location_pre_comma == "北京" ~ "Beijing",
    location_pre_comma == "God's earth" ~ "NA",
    location_pre_comma == "The City College of New York" ~ "New York",
    location_pre_comma == "World" ~ "NA",
    location_pre_comma == "he/they" ~ "NA",
    location_pre_comma == "At the home office" ~ "NA",
    location_pre_comma == "Deutschland" ~ "Germany",
    location_pre_comma == "Distrito Federal" ~ "Mexico City",
    location_pre_comma == "down in dey wid em" ~ "NA",
    location_pre_comma == "Forde-Obama Hall" ~ "NA",
    location_pre_comma == "France & UK" ~ "NA",
    location_pre_comma == "Lil’ Rudyshire" ~ "NA",
    location_pre_comma == "MIT" ~ "Boston",
    location_pre_comma == "New Yorker" ~ "New York",
    location_pre_comma == "OAK / NYC / ATL / The World" ~ "NA",
    location_pre_comma == "SP" ~ "NA",
    location_pre_comma == "Toronto || Ottawa" ~ "NA",
    location_pre_comma == "Tx" ~ "Texas",
    location_pre_comma == "UK" ~ "United Kingdom",
    location_pre_comma == "USA" ~ "United States",
    location_pre_comma == "Worldwide" ~ "NA",
    TRUE ~ location_pre_comma
  ))

tweets_locations <- tweets_locations %>%
  mutate(plot_state = case_when(
    location_pre_comma == "Nashville" ~ "Tennessee",
    location_pre_comma == "Merced" ~ "California",
    location_pre_comma == "Vienna" ~ "Austria",
    location_pre_comma == "Madison" ~ "Wisconsin",
    location_pre_comma == "Minneapolis" ~ "Minnesota",
    location_pre_comma == "Philadelphia" ~ "Pennsylvania",
    location_pre_comma == "Boston" ~ "Massachusetts",
    location_pre_comma == "London" ~ "United Kingdom",
    location_pre_comma == "Edinburgh" ~ "United Kingdom",
    location_pre_comma == "Amherst" ~ "Massachusetts",
    location_pre_comma == "Buffalo" ~ "New York",
    location_pre_comma == "Cambridge" ~ "Massachusetts",
    location_pre_comma == "San Diego" ~ "California",
    TRUE ~ as.character(location_pre_comma)
  ))

top_10_locations <- tweets_locations %>%
  count(plot_state) %>%
  arrange(desc(n)) %>%
  filter(plot_state != "NA") %>%
  head(10) %>%
  mutate(
    internat = case_when(
      plot_state == "United Kingdom" ~ "International",
      plot_state == "Austria" ~ "International",
      TRUE ~ "Domestic"
    ),
    plot_state = fct_reorder(plot_state, n),
    percent_tweets = paste(round(n / sum(n), 4) * 100, "%")
  )
```

```{r question-one-plot-one, out.width="60%", fig.width=6,echo=FALSE, fig.align = "center"}
ggplot(data = top_10_locations, aes(y = plot_state, x = n, fill = internat)) +
  geom_col() +
  geom_text(aes(label = percent_tweets, color = internat),
    size = 2.5,
    nudge_x = 8,
    show.legend = FALSE
  ) +
  scale_fill_manual(values = c("navyblue", "darkred")) +
  scale_color_manual(values = c("navyblue", "darkred")) +
  scale_x_continuous(breaks = c(0, 20, 40, 60, 80, 100, 120, 140, 160, 180, 200)) +
  labs(
    y = "Location Tweeted From",
    x = "Number of Tweets",
    title = "Top 10 #DuBoisChallenge Tweet Locations",
    fill = "Location"
  ) +
  theme_minimal() +
  theme(
    #text = element_text(family = "Times New Roman"),
    legend.title = element_blank(),
    legend.position = c(.85, .17)
  )
```

- Seeking to understand 
what the most popular 
locations at the time
 of tweets were for 
 the #DuBoisChallenge.
- Shows most of the Twitter 
  challenge activity is 
  occurring in the US
- Most represented home 
 location is in New York

---


```{r question-one-plot-two-wrangling, echo = FALSE, out.width = "72%"}
tweets <- tweets %>%
  mutate(tag_count = str_count(content, "@"))

northeast_tweets <- tweets %>%
  filter(
    long <= -70,
    long >= -90,
    lat <= 46,
    lat >= 20
  )
europe_tweets <- tweets %>%
  filter(
    long >= -20 & long <= 45,
    lat >= 30 & lat <= 73
  )

world_map <- ne_countries(
  scale = "medium", type = "map_units",
  returnclass = "sf"
)
us_map <- map_data("state")
canada_map <- map_data("world", "canada")

city_locations <- tribble(
  ~city, ~lat, ~long,
  "NYC", 40.7128, -74.0060,
  "Newark", 40.7357, -74.1724,
  "Baltimore", 39.2904, -76.6122
)
```


```{r question-one-plot-two-northeast, warning = FALSE, out.width="70%", fig.width=4, echo=FALSE}
# Add labels for states and Europe countries

# Do we need to address showing relative populations like we said we would in
# proposal cause of peer feedback??

set.seed(1234)

# labels <- ggplot(data = city_locations, aes(x = Long, y = Lat)) +
#   geom_point(aes(x = Long, y = Lat)) +
#   geom_text(aes(label = City))

plot1 <- ggplot() +
  geom_polygon(
    data = canada_map,
    aes(x = long, y = lat, group = group),
    fill = "#F0F0F0",
    color = "black"
  ) +
  geom_polygon(
    data = us_map,
    aes(x = long, y = lat, group = group),
    fill = "#F0F0F0", color = "black"
  ) +
  geom_jitter(
    data = northeast_tweets,
    width = 0.5, height = .5,
    aes(
      x = long, y = lat, size = tag_count, color = tag_count,
      alpha = tag_count
    ))  +
  labs(
    title = "#DuBoisChallenge Tweets",
    subtitle = "in Northeastern U.S. & Canada\n",
    caption = "Based on Location Where Tweet Was Published",
    size = "# of Users Tagged",
    color = "# of Users Tagged",
    alpha = "# of Users Tagged"
  ) +
  theme_void() +
  scale_color_continuous_sequential(
    palette = "OrYel", rev = FALSE,
    breaks = c(0, 2, 4, 6, 8, 10)
  ) +
  scale_size_continuous(range = c(2, 5), breaks = c(0, 2, 4, 6, 8, 10)) +
  scale_alpha_continuous(range = c(.27, 1), breaks = c(0, 2, 4, 6, 8, 10)) +
  guides(
    color = guide_legend(),
    size = guide_legend(),
    alpha = guide_legend()
  ) +
  theme(
    legend.position = "bottom",
    plot.subtitle = element_text(hjust = 0.5, face = "italic"),
    plot.title = element_text(hjust = 0.5, face = "bold"), 
    plot.caption = element_text(hjust = 0.5),
    panel.border = element_rect(color = "black", fill = NA, size = .75),
    panel.background = element_rect(color = "black", fill = "lightblue")
    #text = element_text(family = "Times New Roman")
  )+
  geom_text_repel(data=city_locations, aes(x=long, y=lat, label=city))+
  coord_map(
    xlim = c(-80, -65),
    ylim = c(36, 46)
  )
  
```

```{r question-one-plot-two-europe, out.width="70%", fig.width=4, echo=FALSE}
# labels_map <- world_map %>% filter(name %in% c(
#   "Paris", "London"
# ))


plot2 <- ggplot() +
  geom_sf(data = world_map, fill = "#F0F0F0", color = "black") +
  geom_jitter(
    data = europe_tweets,
    aes(
      x = long, y = lat, size = tag_count, color = tag_count,
      alpha = tag_count
    )
  ) +
   #geom_sf_label(data = world_map, aes(label = name), label.padding = unit(1, "mm")) +
  coord_sf(xlim = c(-20, 45), ylim = c(30, 73), expand = FALSE) +
  labs(
    title = "#DuBoisChallenge Tweets",
    subtitle = "in Europe\n",
    caption = "Based on Location Where Tweet Was Published",
    size = "# of Users Tagged",
    alpha = "# of Users Tagged",
    color = "# of Users Tagged"
  ) +
  theme_void() +
  scale_color_continuous_sequential(
    palette = "OrYel", rev = FALSE,
    breaks = c(0, 2, 4, 6, 8, 10)
  ) +
  scale_size_continuous(range = c(2, 5), breaks = c(0, 2, 4, 6, 8, 10)) +
  scale_alpha_continuous(range = c(.27, 1), breaks = c(0, 2, 4, 6, 8, 10)) +
  guides(
    color = guide_legend(),
    size = guide_legend(),
    alpha = guide_legend()
  ) +
  theme(
    legend.position = "bottom",
    plot.subtitle = element_text(hjust = 0.5, face = "italic"),
    plot.title = element_text(hjust = 0.5, face = "bold"), 
    plot.caption = element_text(hjust = 0.5),
    panel.border = element_rect(color = "black", fill = NA, size = .75),
    panel.background = element_rect(color = "black", fill = "lightblue")
    #text = element_text(family = "Times New Roman")
  )
```


## Question 1 - Tweet Maps

```{r out.width="95%", fig.width=8, echo=FALSE, warning = FALSE, fig.center = TRUE}
(plot1 + theme(plot.margin = unit(c(0,35,0,0), "pt"))) +
(plot2 + theme(plot.margin = unit(c(0,0,0,35), "pt")))
```

---

class: inverse, middle, center

# Question 2: How does the type of device a tweet author uses to post inform us about how users engage with the tweet and author?

---


## Followers by Device Type

```{r question-two-plot-one-wrangling, echo = FALSE}
tweets <- tweets %>%
  mutate(devicetype = case_when(
    str_detect(text, "Twitter Web App") ~ "Web App",
    str_detect(text, "Twitter for iPhone") ~ "iPhone",
    str_detect(text, "Twitter for Android") ~ "Android",
    str_detect(text, "Buffer") ~ "Buffer",
    str_detect(text, "Twitter for iPad") ~ "iPad",
    str_detect(text, "TweetDeck") ~ "TweetDeck",
    str_detect(text, "Crowdfire App") ~ "Crowdfire App",
    str_detect(text, "Twitter for Mac") ~ "Mac"))

tweets_device <- tweets %>% 
  filter(devicetype == "iPhone" | devicetype == "Web App"| devicetype == "Android")
```


```{r question-two-plot-one, warning = FALSE, out.width="65%", fig.width=6,echo=FALSE, fig.align = "center"}
# warning = FALSE: purposefully set x bounds to remove outlier data points
ggplot(data = tweets_device, aes(x = followers, fill = devicetype)) +
  geom_density(show.legend = FALSE) +
  facet_wrap(. ~ devicetype, scales = "free_y", nrow = 3) +
  theme_minimal() +
  scale_x_continuous(
    breaks = seq(0, 8000, 1000), limit = c(0, 8000),
    labels = label_number(big.mark = ",")
  ) +
  scale_fill_manual(values = c("#a4c639", "#A2AAAD", "#1DA1F2")) +
  scale_y_continuous(labels = label_number(accuracy = .00001)) +
  labs(
    title = "Distribution of Follower Count",
    subtitle = "Stratified by Where Tweet Was Posted From",
    x = "Number of Followers",
    y = NULL
  ) 
#+theme(text = element_text(family = "Times New Roman"))
```

- Shows the relationship between like count and the three most popular device types
- Distribution of followers is heavily right skewed for Web App + Android





---

##Likes by Device Type


```{r question-two-plot-two-wrangling,out.width="100%", fig.width=7, echo=FALSE}
outliers <- tweets_device %>%
  filter(!is.na(like_count)) %>%
  group_by(devicetype) %>%
  summarise(
    IQR = IQR(like_count),
    Q1 = quantile(like_count, 0.25),
    Q3 = quantile(like_count, 0.75),
    farboundary = Q3 + 2 * IQR,
    upper_out = Q3 + 1.5 * IQR,
    lower_out = Q1 - 1.5 * IQR
  )

tweets_likes <- tweets_device %>%
  filter(like_count <= round(outliers$farboundary[3]))
```

```{r question-two-plot-two, out.width="62%", fig.width=4, echo=FALSE, warning = FALSE, fig.align = "center"}

tweets%>%
  mutate(loglikes=log(like_count))%>%
  filter(devicetype == "iPhone" | devicetype == "Web App"| devicetype == "Android")%>%
  ggplot(aes(y = loglikes, fill = devicetype)) +
  facet_wrap(~devicetype) +
  geom_boxplot(show.legend = FALSE) +
  scale_fill_manual(values = c("#a4c639", "#A2AAAD", "#1DA1F2")) +
  labs(
    x = NULL, y = "Number of Likes",
    title = "Distribution of Likes",
    subtitle = "Stratified by Where Tweet Was Posted From",
    caption = "Outliers:\n0 Android, 6 iPhone, 32 Web App"
  ) +
  theme_minimal() +
  theme(
    axis.ticks = element_blank(),
    axis.text.x = element_blank()
    #text = element_text(family = "Times New Roman")
  )
```

- Shows the distribution of followers based on the three most popular device types  
- Web App tweets had the highest median number of followers
- Indicate the ease of writing tweets on a computer vs phone


---

## Math Expressions

You can write LaTeX math expressions inside a pair of dollar signs, e.g. &#36;\alpha+\beta$ renders $\alpha+\beta$. You can use the display style with double dollar signs:

```
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limitations:

1. The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

1. There should not be spaces after the opening `$` or before the closing `$`.

1. Math does not work on the title slide (see [#61](https://github.com/yihui/xaringan/issues/61) for a workaround).

---

class: inverse, middle, center

# Wrap up

---

## Feeling adventurous?

- Want to find out more about `xaringan`? See https://slides.yihui.name/xaringan/#1.

- You are welcomed to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

- But some of you might want to play around with slide styling. The 
`xaringanthemer` provides some solutions for this that: https://pkg.garrickadenbuie.com/xaringanthemer.

- And if you want more bells and whistles, there is also `xaringanExtra`: https://pkg.garrickadenbuie.com/xaringanExtra.
